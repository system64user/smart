(function(n){function c(n){var t=/^vrca=(.*)&vrcb=/i.exec(n);return t.length==2&&t[1]==eccrver1?!0:!1}function l(n){return n.replace(/^vrca=.*&vrcb=/i,"")}function t(){var o=o||0,t=arguments[0];if(v(t))return null;var d=n.isFunction(arguments[1])?arguments[1]():arguments[1],s=((new Date).getTime()-o).toString(),h=new jsSHA("SHA-1","TEXT",{encoding:"UTF8"}),c=new jsSHA("SHA-1","TEXT",{encoding:"UTF8"}),r=t.indexOf("?"),g=r>-1?t.substr(r):"",l=t.indexOf("#"),y=l>-1?t.substr(l):"",i="",u="",p="";h.update("eccod");c.update(s);var f=c.getHash("HEX"),w=CryptoJS.enc.Utf8.parse(f.split("").reverse().join("").substring(0,16)),b=CryptoJS.enc.Utf8.parse(f.substring(0,16)),k=h.getHash("HEX"),nt=CryptoJS.enc.Utf8.parse(k.split("").reverse().join("").substring(0,16)),tt=CryptoJS.enc.Utf8.parse(k.substring(0,16)),e=a(g,d);return u=encodeURIComponent(n.ecProtHPr.AS(echeader1+e.a,b,w)),i=t.substr(0,r>-1?r:t.length)+"?vrqa="+(u?u:"")+"&vrqb="+n.ecProtHPr.AX(s+"."+eczode2+"."+(arguments[2]||"0"),"ecount"),i+="&vrqc="+eccrver1,p=n.isEmpty(e.b)?"":n.ecProtHPr.AS(echeader1+e.b,b,w),n.isEmpty(y)||(i=i+y),{a:i,b:p,c:f}}function a(t,u){var h,c,e,o,s,l,a,v,y,p;if(/(\?|&)vrqa=/i.test(t)&&/&vrq(b|d)=/i.test(t)){var f=n.deparam(t.substring(1));if(f.vrqd&&(h=new jsSHA("SHA-1","TEXT",{encoding:"UTF8"}),h.update("eccod"),c=h.getHash("HEX"),iv1=CryptoJS.enc.Utf8.parse(c.split("").reverse().join("").substring(0,16)),kx1=CryptoJS.enc.Utf8.parse(c.substring(0,16)),paramVal=n.ecProtHPr.BS(f.vrqd,kx1,iv1),paramVal=r(paramVal),f.vrqb=paramVal),f.vrqb)if(e={kx2:"",iv2:""},f=i(f,e),t=n.param(f),t.length>0&&(t="?"+t),/^vrca=/i.test(u)){o={};s="";contentObj=n.deparam(u);u=decodeURIComponent(contentObj.vrca);u=n.ecProtHPr.BS(u,e.kx2,e.iv2);u=r(u);try{o=JSON.parse(u);s="JSON"}catch(w){o=n.deparam(u);s="PARAM"}l=0;for(a in o)o.hasOwnProperty(a)&&l++;l>0&&(delete contentObj.vrca,n.extend(contentObj,o),s=="JSON"?u=Object.toJSON(contentObj):s=="PARAM"&&(u=n.param(contentObj)))}else if(/vrqa=/i.test(u)&&/vrqb=/i.test(u)&&/vrqc=/i.test(u))f=n.deparam(u),f=i(f),u=n.param(f);else if(/^{/.test(u)&&/["']vrqa["'] *:/i.test(u)&&/["']vrqb["'] *:/i.test(u)&&/["']vrqc["'] *:/i.test(u))f=JSON.parse(u),f=i(f),u=Object.toJSON(f);else if(u){v=u;try{u=decodeURIComponent(u);u=n.ecProtHPr.BS(u,e.kx2,e.iv2);u=r(u)}catch(w){u=v}}}else{y=t;p=u;try{/vrqa=/i.test(u)&&/vrqb=/i.test(u)&&/vrqc=/i.test(u)?(f=n.deparam(u),f=i(f),u=n.param(f)):/^{/.test(u)&&/["']vrqa["'] *:/i.test(u)&&/["']vrqb["'] *:/i.test(u)&&/["']vrqc["'] *:/i.test(u)&&(f=JSON.parse(u),f=i(f),u=Object.toJSON(f))}catch(w){t=y;u=p}}return{a:t,b:u}}function i(t,i){var o=n.ecProtHPr.BX(t.vrqb,"ecount"),s=o.split("."),e=new jsSHA("SHA-1","TEXT",{encoding:"UTF8"}),f,u;return e.update(s[0]),f=e.getHash("HEX"),iv2=CryptoJS.enc.Utf8.parse(f.split("").reverse().join("").substring(0,16)),kx2=CryptoJS.enc.Utf8.parse(f.substring(0,16)),u=n.ecProtHPr.BS(t.vrqa,kx2,iv2),u=r(u),delete t.vrqa,delete t.vrqb,delete t.vrqc,n.extend(t,n.deparam(u.replace(/^\?/,""))),i&&(i.iv2=iv2,i.kx2=kx2),t}function r(n){var t=n.substring(0,echeader1.length);return t==echeader1?n.substring(echeader1.length):n}function v(t){var f=n.url(t),i,e;if(/^\/GMCAPI/i.test(f.relative)==!0)return!1;if(/^\/ECMAIN/i.test(f.relative)==!0){for(i=0,e=u.length;i<e;i++)if(u[i].test(f.relative))return!1;return!0}if(f.host=="userpc.ecountassistant.com")return!1;if(!n.isEmpty(f.host)&&!n.isEmpty(window.location.host)){var r=(f.host||"").split("."),o=(window.location.host||"").split("."),s=0;if(r.length>0)if(r.length==o.length){for(r.length>2&&r[0].indexOf(o[0])!=0&&s++,i=r.length==1?0:1,e=r.length;i<e;i++)r[i]!=o[i]&&s++;if(s>0)return!0}else return!0;else return!0}return!1}function y(n){for(var t,f=n||"",i=[],r=0,u=0;u<f.length;u++)t=f.charCodeAt(u),t<128?i[r++]=t:t<2048?(i[r++]=t>>6|192,i[r++]=t&63|128):(i[r++]=t>>12|224,i[r++]=t>>6&63|128,i[r++]=t&63|128);return i}function p(n){if(jQuery.type(n)!=="array")return n.toString();for(var r=[],t=0,e=n.length,u,f,i;t<e;){i=n[t++];switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r.push(String.fromCharCode(i));break;case 12:case 13:u=n[t++];r.push(String.fromCharCode((i&31)<<6|u&63));break;case 14:u=n[t++];f=n[t++];r.push(String.fromCharCode((i&15)<<12|(u&63)<<6|(f&63)<<0))}}return r.join("")}function e(){var t=arguments,i=t[0].target;n.encryptForm(i)}var u,o,s,h,f;n.ajaxSetup({beforeSend:function(i,r){var u,o,e,f,s;r&&(r.jsonParse===!0?(u=t(r.url,r.data,"1"),u!=null&&(r.contentType=="application/x-www-form-urlencoded"&&(r.forceContentUrlEncode=!0),o=r.forceContentUrlEncode===!0?encodeURIComponent(u.b):u.b,r.url=u.a,r.data="vrca="+o,e=r.success,r.success=function(t,i,f){var s,h,a,o;if(n.type(t)==="string"&&c(t)==!0){t=l(t);s=CryptoJS.enc.Utf8.parse(u.c.split("").reverse().join("").substring(0,16));h=CryptoJS.enc.Utf8.parse(u.c.substring(0,16));t=n.ecProtHPr.BS(t,h,s);a=t.substring(0,echeader1.length);a==echeader1?t=t.substring(echeader1.length):(o='Encoding mismatch.\n\n Set your web browser to <span class="text-bold">UTF-8<\/span> character encoding type.',ecount.alert?ecount.alert(o,function(){}):alert(o));switch(r.dataTypeCustom){case"json":t=JSON.parse(t);break;case"xml":t=n.parseXML(t)}}n.isFunction(e)&&e(t,i,f)})):r.skiplog==!0&&n.type(r.url)==="string"&&(f=r.url.indexOf("?"),s=f>-1?r.url.substr(f):"",r.url+=f>-1?"&skelog=1":"?skelog=1"))}});n.extend({encryptForm:function(i,r){var e,u,a,s,v,h,l,c,f;if(o.contains((i.enctype||"").toLowerCase()))if(e=i.action||i.baseURI||window.location.href,u=null,(i.method||"").toLowerCase()=="get"){if(a=n(i).serialize(),s=e.indexOf("?"),s>-1?(h=e.substring(s+1),h+="&"+a,e=e.substring(0,s+1)+n.param(n.deparam(h))):e+="?"+a,u=t(e,""),u!=null&&(f=u.a,c=n(i),r&&(f+=[f.indexOf("?")>-1?"&":"?",r].join("")),s=f.indexOf("?"),c.find("input").remove(),s>-1)){v=f.substring(s+1);h=n.deparam(v);for(l in h)h.hasOwnProperty(l)&&c.append('<input type="hidden" name="'+l+'" value="'+h[l]+'"/>')}}else u=t(e,function(){return n(i).serialize()}),u!=null&&(c=n(i),f=u.a,r&&(f+=[f.indexOf("?")>-1?"&":"?",r].join("")),i.action=f,c.find("input").remove(),n.isEmpty(u.b)||c.append('<input type="hidden" name="vrca" value="'+u.b+'"/>'))},ecrt:function(n){var i=t(n,"");return i!=null?i.a:n}});n.extend({ecProtHPr:{AS:function(t,i,r){var u=pako.deflateRaw(t,{to:"string"}),f;return u=n.ecProtHPr.AB(u),f=CryptoJS.AES.encrypt(u,i,{keySize:16,iv:r,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),f.toString()},BS:function(t,i,r){var u=CryptoJS.AES.decrypt(t,i,{keySize:16,iv:r,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7});return pako.inflateRaw(n.ecProtHPr.BB(u.toString(CryptoJS.enc.Utf8)),{to:"string"})},AX:function(n,t){var r,u,i,e,f;for(t=t||"",r=y(n),u=[],i=0,e=r.length;i<e;i++)f=(r[i]^t.charCodeAt(i%t.length)).toString(16),u.push((f.length<2?"0":"")+f.toLowerCase());return u.join("")},BX:function(t,i){var r=t,e=[],u,o;i=i||"";n.isEmpty(i)&&(u=parseInt(r.substring(0,1)),i=r.substring(1,u+1),r=r.substring(1+u));for(var f=0,s=0,h=r.length;f<h;f+=2)o=parseInt(r.substr(f,2),16),e.push(o^i.charCodeAt(s++%i.length));return p(e)},AB:function(n){var o,s,h,r,c,l,a,v,y=[],f="",t,e,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=n;if(t=i.length%3,t>0)while(t++<3)f+="=",i+='\0';for(t=0;t<i.length;t+=3)o=i.charCodeAt(t),s=i.charCodeAt(t+1),h=i.charCodeAt(t+2),r=o<<16|s<<8|h,c=r>>18&63,l=r>>12&63,a=r>>6&63,v=r&63,y[t/3]=u.charAt(c)+u.charAt(l)+u.charAt(a)+u.charAt(v);return e=y.join(""),e.slice(0,e.length-f.length)+f},BB:function(n){for(var r,o,c,l,a,s,h,u,f=[],e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=n,t=0;t<i.length;t+=4)l=e.indexOf(i.charAt(t)),a=e.indexOf(i.charAt(t+1)),s=e.indexOf(i.charAt(t+2)),h=e.indexOf(i.charAt(t+3)),u=l<<18|a<<12|s<<6|h,r=u>>>16&255,o=u>>>8&255,c=u&255,f[t/4]=String.fromCharCode(r,o,c),h==64&&(f[t/4]=String.fromCharCode(r,o)),s==64&&(f[t/4]=String.fromCharCode(r));return f.join("")}}});u=[/^\/ECMAIN\/EPG\/EPG024M.aspx/i,/^\/ECMAIN\/EPG\/EPG025M.aspx/i,/^\/ECMAIN\/EPG\/EPG012M.aspx/i,/^\/ECMAIN\/EPZ\/EPZ006M.aspx/i,/^\/ECMain\/CM2\/CM2_Search_Pay_Main.aspx/i,/^\/ECMain\/EPZ\/EPZ013M.aspx/i,/^\/ECMain\/EPZ\/EPZ016M.aspx/i];o=["text/plain","application/x-www-form-urlencoded"];window.onsubmit?(s=window.onsubmit,window.onsubmit=function(){s.apply(null,arguments);e.apply(null,arguments)}):window.onsubmit=e;h="about:blank";window.open&&(f=window.open,window.open=function(){var u=arguments[0],e=arguments[2],r,i,o;return n.trim(u.toString())==h?f.apply(null,arguments):(r=t(u,""),r!=null&&(i=r.a,e&&(i+=[i.indexOf("?")>-1?"&":"?",e].join("")),arguments[0]=i),f.apply(null,arguments))})})(jQuery);