!function(){function e(e,t,n,r,i,a,o){try{var l=e[a](o),s=l.value}catch(c){return void n(c)}l.done?t(s):Promise.resolve(s).then(r,i)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}System.register([],(function(){"use strict";return{execute:function(){"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var t={exports:{}};(function(e,t){var n={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function r(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function i(e){try{delete window[e]}catch(t){window[e]=void 0}}function a(e){var t=document.getElementById(e);t&&document.getElementsByTagName("head")[0].removeChild(t)}function o(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=e,l=t.timeout||n.timeout,s=t.jsonpCallback||n.jsonpCallback,c=void 0;return new Promise((function(n,d){var u=t.jsonpCallbackFunction||r(),m=s+"_"+u;window[u]=function(e){n({ok:!0,json:function(){return Promise.resolve(e)}}),c&&clearTimeout(c),a(m),i(u)},o+=-1===o.indexOf("?")?"?":"&";var f=document.createElement("script");f.setAttribute("src",""+o+s+"="+u),t.charset&&f.setAttribute("charset",t.charset),t.nonce&&f.setAttribute("nonce",t.nonce),t.referrerPolicy&&f.setAttribute("referrerPolicy",t.referrerPolicy),f.id=m,document.getElementsByTagName("head")[0].appendChild(f),c=setTimeout((function(){d(new Error("JSONP request to "+e+" timed out")),i(u),a(m),window[u]=function(){i(u)}}),l),f.onerror=function(){d(new Error("JSONP request to "+e+" failed")),i(u),a(m),c&&clearTimeout(c)}}))}t.exports=o})(0,t);var a,o,l,s,c,d,u,m=t.exports;a=Drupal,o=OVH,l=drupalSettings,u={variables:{fieldsValidityStatus:{}},computed:{webmailInfo:null,webmailAPIURL:""},constants:{apiEUUrl:"https://msservices.eu.ovhapis.com/1.0/webmail/",apiCAUrl:"https://msservices.ca.ovhapis.com/1.0/webmail/",apiErrorMessage:"An error occured, please retry later",emptyFieldMessage:"This field is required",wrongEmailMessage:"Please verify your email address",loginV1types:["EXCHANGE","EMAILPRO","MXPLAN"],loginV3types:["MAILHA","HOSTEDEMAIL"],countriesApiCA:["en","en-ca","fr-ca","es-419","en-sg","en-142","en-au"]},elements:{form:null===(s=document.querySelector("[data-webmail-form-container]"))||void 0===s?void 0:s.closest("form"),emailField:document.querySelector("[data-webmail-input-email]"),passwordField:document.querySelector("[data-webmail-input-password]"),requiredFields:document.querySelectorAll("input[required]"),saveAddressField:document.querySelector('[data-webmail-input="save-adress"]')},methods:{initialize:function(){if(u.elements.emailField&&u.elements.passwordField&&u.elements.saveAddressField){u.computed.webmailAPIURL=u.constants.countriesApiCA.includes(l.path.currentLanguage)?u.constants.apiCAUrl:u.constants.apiEUUrl;var e=localStorage.getItem("email");e&&(u.elements.emailField.value=e,u.elements.passwordField.focus(),u.elements.saveAddressField.checked=!0,u.methods.getMailInfo(u.elements.emailField.value)),i(u.elements.requiredFields).forEach((function(e){var t=e.getAttribute("id");u.variables.fieldsValidityStatus[t]||(u.variables.fieldsValidityStatus=n(n({},u.variables.fieldsValidityStatus),{},r({},t,!1)))})),u.events.formSubmit(),u.events.checkEmailRemember(),u.events.validateWithEnter()}},inputCheck:function(e){var t,n=e.getAttribute("id"),r=null===(t=u.elements.form)||void 0===t?void 0:t.querySelector('[data-error-id="'.concat(e.getAttribute("id"),'"]'));e.checkValidity()?(u.variables.fieldsValidityStatus[n]=!0,e.classList.remove("error"),u.methods.updateFieldErrorMessage(r),"email"===e.type&&u.methods.emailCheck(e)):(u.variables.fieldsValidityStatus[n]=!1,e.classList.add("error"),u.methods.updateFieldErrorMessage(r,u.constants.emptyFieldMessage))},emailCheck:function(e){var t,n=e.getAttribute("id"),r=null===(t=u.elements.form)||void 0===t?void 0:t.querySelector('[data-error-id="'.concat(e.getAttribute("id"),'"]'));u.methods.getMailInfo(e.value).then((function(t){var i;"ok"===t.status?(u.variables.fieldsValidityStatus[n]=!0,e.classList.remove("error"),null!==(i=u.elements.saveAddressField)&&void 0!==i&&i.checked&&localStorage.setItem("email",e.value),u.methods.generateWebmailInfo(t)):(u.computed.webmailInfo=null,u.variables.fieldsValidityStatus[n]=!1,e.classList.add("error"),u.methods.updateFieldErrorMessage(r,u.constants.wrongEmailMessage))})).catch((function(){u.methods.displayGlobalErrorMessage()}))},generateWebmailInfo:function(e){var t,n;u.computed.webmailInfo={adfsUrl:e.adfsUrl?e.adfsUrl:"",authentication:e.authentication?e.authentication:"",protocol:e.protocols?e.protocols[0].host:"",type:e.type?e.type:"",webmailUrl:e.webmailUrl?e.webmailUrl:""},u.methods.triggerPost(u.computed.webmailInfo,null===(t=u.elements.emailField)||void 0===t?void 0:t.value,null===(n=u.elements.passwordField)||void 0===n?void 0:n.value)},updateFieldErrorMessage:function(e,t){e&&(t?(e.classList.remove("d-none"),e.textContent=o.t(t)):(e.classList.add("d-none"),e.textContent=""))},displayGlobalErrorMessage:function(){var e,t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("span"),i=document.createElement("div");t.classList.add("oui-alert","oui-alert--error","position-relative","text-left","mt-4"),n.classList.add("oui-alert__container","d-flex","flex-row","align-items-start","align-items-md-center","p-3"),r.classList.add("oui-alert__icon","icon--error","mr-3"),i.classList.add("oui-alert__message"),i.innerHTML=o.t(u.constants.apiErrorMessage),n.appendChild(r),n.appendChild(i),t.appendChild(n),u.elements.form&&(null===(e=u.elements.form.querySelector(".oui-alert"))||void 0===e||e.remove(),u.elements.form.appendChild(t))},getMailInfo:(c=regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new URL(u.computed.webmailAPIURL)).searchParams.append("email",t),r=new Request(n.toString()),e.abrupt("return",new Promise((function(e,t){fetch(r).then((function(t){return e(t.json())})).catch((function(e){return t(e)}))})));case 4:case"end":return e.stop()}}),e)})),d=function(){var t=this,n=arguments;return new Promise((function(r,i){var a=c.apply(t,n);function o(t){e(a,r,i,o,l,"next",t)}function l(t){e(a,r,i,o,l,"throw",t)}o(void 0)}))},function(e){return d.apply(this,arguments)}),triggerPost:function(e,t,n){if(e&&e.type&&e.webmailUrl&&t&&n)if(u.constants.loginV3types.includes(e.type))m("".concat(e.webmailUrl,"getlogintoken.php"),{jsonpCallbackFunction:"handleJSON2"}).then((function(e){return e.json()})).then((function(r){u.methods.postWithToken(r.status,t,n,e.webmailUrl,r.msg)})).catch((function(e){throw u.methods.displayGlobalErrorMessage(),e}));else if(u.constants.loginV1types.includes(e.type)&&"v1"===e.authentication)u.methods.postToWebmail(t,n,e.webmailUrl,"".concat(e.webmailUrl,"/auth/owaauth.dll"));else{if(!e.adfsUrl||!e.protocol||"v2"!==e.authentication)return!1;u.methods.postToWebmail(t,n,e.webmailUrl,"https://".concat(e.adfsUrl,"/adfs/ls/?wa=wsignin1.0&wtrealm=https%3a%2f%2f").concat(e.protocol,"%2fowa%2f&wctx=rm%3d0%26id%3dpassive%26ru%3d%252fowa%252f%253fauthRedirect%253dtrue&wct=2017-09-28T10%3a21%3a41Z"))}},postToWebmail:function(e,t,n,r,i){var a,o="";o=i?'<form class="d-none" data-subform action="'.concat(r,'?_task=login" method="post">\n            <input type="hidden" name="_token" value="').concat(i,'" />\n            <input type="hidden" name="_task" value="login" />\n            <input type="hidden" name="_action" value="login" />\n            <input type="hidden" name="_timezone" value="" />\n            <input type="hidden" name="_url" value="_task=login" />\n            <input type="hidden" name="_user" value="').concat(e,'" />\n            <input type="hidden" name="_pass" value="').concat(t,'" />\n          </form>'):'<form class="d-none" data-subform action="'.concat(r,'" method="post">\n            <input name="destination" value="').concat(n,'" />\n            <input name="flags" value="0" />\n            <input name="forcedownlevel" value="0" />\n            <input name="trusted" value="0" />\n            <input name="username" value="').concat(e,'" />\n            <input name="password" value="').concat(t,'" />\n            <input name="isUtf8" value="1" />\n          </form>');var l=document.createElement("div");l.innerHTML=o,null===(a=document.querySelector("body"))||void 0===a||a.appendChild(l),document.querySelector("[data-subform]").submit()},postWithToken:function(e,t,n,r,i){100===e&&u.methods.postToWebmail(t,n,"","".concat(r,"?_task=login"),i)}},events:{formSubmit:function(){var e;null===(e=u.elements.form)||void 0===e||e.addEventListener("submit",(function(e){e.preventDefault(),i(u.elements.requiredFields).forEach((function(e){u.methods.inputCheck(e)}))}))},checkEmailRemember:function(){var e;null===(e=u.elements.saveAddressField)||void 0===e||e.addEventListener("change",(function(){var e,t,n;if(null!==(e=u.elements.saveAddressField)&&void 0!==e&&e.checked||!localStorage.getItem("email")){if(null!==(t=u.elements.saveAddressField)&&void 0!==t&&t.checked&&null!==(n=u.elements.emailField)&&void 0!==n&&n.value){var r;localStorage.setItem("email",null===(r=u.elements.emailField)||void 0===r?void 0:r.value)}}else localStorage.removeItem("email")}))},validateWithEnter:function(){var e;null===(e=u.elements.passwordField)||void 0===e||e.addEventListener("keyup",(function(e){"Enter"===e.code&&i(u.elements.requiredFields).forEach((function(e){u.methods.inputCheck(e)}))}))}}},a.behaviors.webmailLogin={attach:function(){u.methods.initialize()}}}}}))}();
