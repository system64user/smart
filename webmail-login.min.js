var E=Object.defineProperty,L=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var F=(d,l,o)=>l in d?E(d,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[l]=o,A=(d,l)=>{for(var o in l||(l={}))M.call(l,o)&&F(d,o,l[o]);if(w)for(var o of w(l))_.call(l,o)&&F(d,o,l[o]);return d},S=(d,l)=>L(d,U(l));function j(){import("data:text/javascript,")}var q=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},g={exports:{}};(function(d,l){(function(o,t){t(l,d)})(q,function(o,t){var p={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function e(){return"jsonp_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function a(r){try{delete window[r]}catch{window[r]=void 0}}function i(r){var n=document.getElementById(r);n&&document.getElementsByTagName("head")[0].removeChild(n)}function s(r){var n=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],m=r,b=n.timeout||p.timeout,f=n.jsonpCallback||p.jsonpCallback,h=void 0;return new Promise(function(k,y){var c=n.jsonpCallbackFunction||e(),v=f+"_"+c;window[c]=function(C){k({ok:!0,json:function(){return Promise.resolve(C)}}),h&&clearTimeout(h),i(v),a(c)},m+=m.indexOf("?")===-1?"?":"&";var u=document.createElement("script");u.setAttribute("src",""+m+f+"="+c),n.charset&&u.setAttribute("charset",n.charset),n.nonce&&u.setAttribute("nonce",n.nonce),n.referrerPolicy&&u.setAttribute("referrerPolicy",n.referrerPolicy),u.id=v,document.getElementsByTagName("head")[0].appendChild(u),h=setTimeout(function(){y(new Error("JSONP request to "+r+" timed out")),a(c),i(v),window[c]=function(){a(c)}},b),u.onerror=function(){y(new Error("JSONP request to "+r+" failed")),a(c),i(v),h&&clearTimeout(h)}})}t.exports=s})})(g,g.exports);var T=g.exports;((d,l,o)=>{var p;const t={variables:{fieldsValidityStatus:{}},computed:{webmailInfo:null,webmailAPIURL:""},constants:{apiEUUrl:"https://msservices.eu.ovhapis.com/1.0/webmail/",apiCAUrl:"https://msservices.ca.ovhapis.com/1.0/webmail/",apiErrorMessage:"An error occured, please retry later",emptyFieldMessage:"This field is required",wrongEmailMessage:"Please verify your email address",loginV1types:["EXCHANGE","EMAILPRO","MXPLAN"],loginV3types:["MAILHA","HOSTEDEMAIL"],countriesApiCA:["en","en-ca","fr-ca","es-419","en-sg","en-142","en-au"]},elements:{form:(p=document.querySelector("[data-webmail-form-container]"))==null?void 0:p.closest("form"),emailField:document.querySelector("[data-webmail-input-email]"),passwordField:document.querySelector("[data-webmail-input-password]"),requiredFields:document.querySelectorAll("input[required]"),saveAddressField:document.querySelector('[data-webmail-input="save-adress"]')},methods:{initialize:()=>{if(!t.elements.emailField||!t.elements.passwordField||!t.elements.saveAddressField)return;t.computed.webmailAPIURL=t.constants.countriesApiCA.includes(o.path.currentLanguage)?t.constants.apiCAUrl:t.constants.apiEUUrl;const e=localStorage.getItem("email");e&&(t.elements.emailField.value=e,t.elements.passwordField.focus(),t.elements.saveAddressField.checked=!0,t.methods.getMailInfo(t.elements.emailField.value)),[...t.elements.requiredFields].forEach(a=>{const i=a.getAttribute("id");t.variables.fieldsValidityStatus[i]||(t.variables.fieldsValidityStatus=S(A({},t.variables.fieldsValidityStatus),{[i]:!1}))}),t.events.formSubmit(),t.events.checkEmailRemember(),t.events.validateWithEnter()},inputCheck:e=>{var s;const a=e.getAttribute("id"),i=(s=t.elements.form)==null?void 0:s.querySelector(`[data-error-id="${e.getAttribute("id")}"]`);e.checkValidity()?(t.variables.fieldsValidityStatus[a]=!0,e.classList.remove("error"),t.methods.updateFieldErrorMessage(i),e.type==="email"&&t.methods.emailCheck(e)):(t.variables.fieldsValidityStatus[a]=!1,e.classList.add("error"),t.methods.updateFieldErrorMessage(i,t.constants.emptyFieldMessage))},emailCheck:e=>{var s;const a=e.getAttribute("id"),i=(s=t.elements.form)==null?void 0:s.querySelector(`[data-error-id="${e.getAttribute("id")}"]`);t.methods.getMailInfo(e.value).then(r=>{var n;r.status==="ok"?(t.variables.fieldsValidityStatus[a]=!0,e.classList.remove("error"),(n=t.elements.saveAddressField)!=null&&n.checked&&localStorage.setItem("email",e.value),t.methods.generateWebmailInfo(r)):(t.computed.webmailInfo=null,t.variables.fieldsValidityStatus[a]=!1,e.classList.add("error"),t.methods.updateFieldErrorMessage(i,t.constants.wrongEmailMessage))}).catch(()=>{t.methods.displayGlobalErrorMessage()})},generateWebmailInfo:e=>{var a,i;t.computed.webmailInfo={adfsUrl:e.adfsUrl?e.adfsUrl:"",authentication:e.authentication?e.authentication:"",protocol:e.protocols?e.protocols[0].host:"",type:e.type?e.type:"",webmailUrl:e.webmailUrl?e.webmailUrl:""},t.methods.triggerPost(t.computed.webmailInfo,(a=t.elements.emailField)==null?void 0:a.value,(i=t.elements.passwordField)==null?void 0:i.value)},updateFieldErrorMessage:(e,a)=>{!e||(a?(e.classList.remove("d-none"),e.textContent=l.t(a)):(e.classList.add("d-none"),e.textContent=""))},displayGlobalErrorMessage:()=>{var r;const e=document.createElement("div"),a=document.createElement("div"),i=document.createElement("span"),s=document.createElement("div");e.classList.add("oui-alert","oui-alert--error","position-relative","text-left","mt-4"),a.classList.add("oui-alert__container","d-flex","flex-row","align-items-start","align-items-md-center","p-3"),i.classList.add("oui-alert__icon","icon--error","mr-3"),s.classList.add("oui-alert__message"),s.innerHTML=l.t(t.constants.apiErrorMessage),a.appendChild(i),a.appendChild(s),e.appendChild(a),t.elements.form&&((r=t.elements.form.querySelector(".oui-alert"))==null||r.remove(),t.elements.form.appendChild(e))},getMailInfo:async e=>{const a=new URL(t.computed.webmailAPIURL);a.searchParams.append("email",e);const i=new Request(a.toString());return new Promise((s,r)=>{fetch(i).then(n=>s(n.json())).catch(n=>r(n))})},triggerPost:(e,a,i)=>{if(!(!e||!e.type||!e.webmailUrl||!a||!i))if(t.constants.loginV3types.includes(e.type))T(`${e.webmailUrl}getlogintoken.php`,{jsonpCallbackFunction:"handleJSON2"}).then(s=>s.json()).then(s=>{t.methods.postWithToken(s.status,a,i,e.webmailUrl,s.msg)}).catch(s=>{throw t.methods.displayGlobalErrorMessage(),s});else if(t.constants.loginV1types.includes(e.type)&&e.authentication==="v1")t.methods.postToWebmail(a,i,e.webmailUrl,`${e.webmailUrl}/auth/owaauth.dll`);else if(e.adfsUrl&&e.protocol&&e.authentication==="v2")t.methods.postToWebmail(a,i,e.webmailUrl,`https://${e.adfsUrl}/adfs/ls/?wa=wsignin1.0&wtrealm=https%3a%2f%2f${e.protocol}%2fowa%2f&wctx=rm%3d0%26id%3dpassive%26ru%3d%252fowa%252f%253fauthRedirect%253dtrue&wct=2017-09-28T10%3a21%3a41Z`);else return!1},postToWebmail:(e,a,i,s,r)=>{var f;let n="";r?n=`<form class="d-none" data-subform action="${s}?_task=login" method="post">
            <input type="hidden" name="_token" value="${r}" />
            <input type="hidden" name="_task" value="login" />
            <input type="hidden" name="_action" value="login" />
            <input type="hidden" name="_timezone" value="" />
            <input type="hidden" name="_url" value="_task=login" />
            <input type="hidden" name="_user" value="${e}" />
            <input type="hidden" name="_pass" value="${a}" />
          </form>`:n=`<form class="d-none" data-subform action="${s}" method="post">
            <input name="destination" value="${i}" />
            <input name="flags" value="0" />
            <input name="forcedownlevel" value="0" />
            <input name="trusted" value="0" />
            <input name="username" value="${e}" />
            <input name="password" value="${a}" />
            <input name="isUtf8" value="1" />
          </form>`;const m=document.createElement("div");m.innerHTML=n,(f=document.querySelector("body"))==null||f.appendChild(m),document.querySelector("[data-subform]").submit()},postWithToken:(e,a,i,s,r)=>{e===100&&t.methods.postToWebmail(a,i,"",`${s}?_task=login`,r)}},events:{formSubmit:()=>{var e;(e=t.elements.form)==null||e.addEventListener("submit",a=>{a.preventDefault(),[...t.elements.requiredFields].forEach(i=>{t.methods.inputCheck(i)})})},checkEmailRemember:()=>{var e;(e=t.elements.saveAddressField)==null||e.addEventListener("change",()=>{var a,i,s,r;!((a=t.elements.saveAddressField)!=null&&a.checked)&&localStorage.getItem("email")?localStorage.removeItem("email"):((i=t.elements.saveAddressField)==null?void 0:i.checked)&&((s=t.elements.emailField)==null?void 0:s.value)&&localStorage.setItem("email",(r=t.elements.emailField)==null?void 0:r.value)})},validateWithEnter:()=>{var e;(e=t.elements.passwordField)==null||e.addEventListener("keyup",a=>{a.code==="Enter"&&[...t.elements.requiredFields].forEach(i=>{t.methods.inputCheck(i)})})}}};d.behaviors.webmailLogin={attach(){t.methods.initialize()}}})(Drupal,OVH,drupalSettings);export{j as __vite_legacy_guard};
