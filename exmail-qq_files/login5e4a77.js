$(function(){var e=$.fn.countryCodeDropdown,i=86,a=$("#loginForm div[data-panel=qrcode]"),n=$("#loginForm div[data-panel=pwd]"),t=($(".js_show_pwd_panel"),$(".js_show_qrcode_panel"),$(".login_content_wrap[data-content-type=qrcode]")),o=$(".login_content_wrap[data-content-type=verifycode]"),r=$(".js_verify_item"),m=$("#btn_sms"),d=$("#mobile"),c=$("#area"),s=$("#sms_token"),l=$("#sms_token2"),_=$("#sms_login_btn"),f=$("#wx_token"),p=$("#vc"),u=($("#token"),$("#inputuin")),h=$("#pp"),v=$("#VerifyArea"),g=$("#sms_token2_login"),b=$("#wx_token_login"),w=($("#get_verify_code_btn"),0),y=$(".js_login_item_wrapper"),x=$(".login_captcha_wrapper"),T=$("#js_login_captcha_img"),k=$("#captcha_val"),I=$("#verify_phone_sms_btn"),L=$("#accountList"),C=$("#login_choose_acc"),q=null,j=te("find_mobile"),z=te("find_area"),A=te("find_alias");if(".qq.com"===location.host.substr(-7)&&"exmail.weixin.qq.com"!=location.host)try{document.domain="exmail.qq.com"}catch(ve){document.domain="qq.com"}try{!function ge(){var i=window.navigator.userAgent.toLowerCase(),e="web";function a(e){return e.test(i)}if(a(/applewebkit/g))if(a(/edge/g))e="edge";else if(a(/opr/g))e="opera";else if(a(/chrome/g)){e="chrome";var n=window.external;n&&"SEVersion"in n?e="sogou":a(/qqbrowser/g)?e="qq":a(/ubrowser/g)&&(e="uc")}else a(/safari/g)&&(e="safari");else a(/gecko/g)&&a(/firefox/g)?supportaer="firefox":a(/presto/g)?e="opera":a(/trident|compatible|msie/g)&&(e="ie");$("[name=device_name]").val(e),FingerprintJS.load().then(function(e){return e.get()}).then(function(e){e&&e.visitorId&&$("[name=fingerprint_deviceid]").val(e.visitorId)})}()}catch(be){console.log("deviceid err",be)}if(function(){function n(e,i,a){var n="";if(0!=(a=a||0)){var t=new Date;t.setTime(t.getTime()+1e3*a),n="; expires="+t.toGMTString()}document.cookie=e+"="+escape(i)+n+"; path=/"}$.extend($.fn,{setCookie:function(e,i,a){n(e,i,a)},delCookie:function(e){!function i(e){n(e,"",-1)}(e)}})}(),j&&z){var E=$("#verify_phone_item");$(".js_verify_phone_txt").html("+"+z+" "+j),C.append('<input type="hidden" id="mobile" name="mobile" value="'+j+'">'),C.append('<input type="hidden" id="area" name="area" value="'+z+'">'),C.find('[name="uin"]').val(A),$("#verify_phone_btn").attr("data-type","member"),L.hide(),E.show(),ie(60,I),$.ajax({url:"/cgi-bin/bizmail_portal?action=send_sms&type=11&t=biz_rf_portal_mgr&ef=jsnew&resp_charset=UTF8",data:{area:z,mobile:j},dataType:"JSON",success:function(e){console.log("sms json = ",e),"0"==e.retcode||("-2"==e.retcode?oe(m,"The mobile phone has not been bound and the verification code cannot be sent."):"-101"==e.retcode?oe(m,"The operation speed is too fast. Please try again in 1 minute."):oe(m,"Failed to send CAPTCHA"))},complete:function(){}})}function N(){Q()?(m.removeClass("disabled"),re(d)):m.addClass("disabled")}function P(i,e){var a=i.parents(".signup_item_content");a.on("mouseenter",function(){a.removeClass("input_normal").removeClass("input_focus").addClass("input_hover")}).on("mouseleave",function(){i.is(":focus")||a.removeClass("input_hover").removeClass("input_focus").addClass("input_normal")}),i.on("focus",function(e){a.removeClass("input_hover").removeClass("input_normal").addClass("input_focus"),re(i)}).on("blur",function(){a.removeClass("input_hover").removeClass("input_focus").addClass("input_normal"),e&&(Q()||oe(i))})}$("#second_checkcode_login").on("click",function(e){var i=$("#second_check_vcode");if(""===$.trim(i.val()))return oe(i,"Enter the verification code"),!1;""===document.form1.domain.value&&(document.form1.domain.value="biz.mail.qq.com"),"mail.exmail.qq.com"==location.host&&(document.form1.domain_bak.value="1"),document.form1.submit()}),g.on("click",function(e){if(""===$.trim(l.val()))return oe(l),!1;""===document.form1.domain.value&&(document.form1.domain.value="biz.mail.qq.com"),"mail.exmail.qq.com"==location.host&&(document.form1.domain_bak.value="1"),document.form1.submit()}),b.on("click",function(e){if(""===$.trim(f.val()))return oe(f),!1;document.form1.submit()}),l.on("focus",function(){re(l)}),"account"===(te("logintype")||"wechat")&&(a.hide(),n.show()),h.on("focus",function(){re($(this))}),v.on("focus",function(){re($(this))}),$(".js_show_pwd_panel").click(function(e){_e("pwd"),"https://exmail.qq.com/login"!==location.href&&"https://exmail.weixin.qq.com/login"!==location.href||X("ActiveCodeLogin","pwd_click")}),$(".js_show_phone_panel").click(function(e){_e("phone"),ne()}),$(".js_show_scan_panel").click(function(e){_e("qrcode")}),$(".js_show_qrcode_panel").click(function(e){_e("qrcode")}),r.click(function(e){var i=$(this);r.removeClass("curr"),i.addClass("curr"),"wechat"===i.attr("data-type")?(t.show(),o.hide()):"phone"===i.attr("data-type")&&(t.hide(),o.show(),ne(),X("WwBizmailLogin","mobile_page"),X("ActiveCodeLogin","mobile_verifycode_click"))}),c.on("input propertychange",N),d.on("input propertychange",N),P(d,!0),P(f),P(s),P(p);var O=function(){var e=T.attr("src")||T.data("src");T.attr("src",e.replace(/([&?]r=)([^&]+)/,"$1"+(new Date).getTime()))};x.on("click",O),k.on("focus",function(){re($(this))}),m.click(function(){m.hasClass("disabled")||(new TencentCaptcha("2016770177",function(e){console.log("TencentCaptcha res = ",e),0==e.ret?(function n(e){if(m.attr("data-mobile"))var i=m.attr("data-mobile");else var i=$.trim(d.val());if(m.attr("data-area"))var a=m.attr("data-area");else var a=$.trim(c.val());if(!Q())return void oe(d);ie(60),$.ajax({url:"/cgi-bin/bizmail_portal?action=send_sms&type=11&t=biz_rf_portal_mgr&ef=jsnew&resp_charset=UTF8",data:{area:a,mobile:i,ticket:encodeURIComponent(e.ticket),randstr:encodeURIComponent(e.randstr)},dataType:"JSON",success:function(e){"0"==e.retcode||("-2"==e.retcode?oe(m,"The mobile phone has not been bound and the verification code cannot be sent."):"-101"==e.retcode?oe(m,"The operation speed is too fast. Please try again in 1 minute."):-201==e.retcode?(y.show(),O(),ie(0),oe(k,"Enter the CAPTCHA code")):-202==e.retcode?(oe(k,"Image verification code error"),ie(0),O()):-1e4==e.retcode?(oe(m,"The number of times the verification code of this mobile number has been obtained has reached the daily limit."),ie(0),m.addClass("disabled")):oe(m,"Failed to send CAPTCHA"))},complete:function(){}})}(e),(new Image).src="/qy_mng_logic/reportKV?type=RegCaptcha&itemName=captcha_succ"):2==e.ret&&((new Image).src="/qy_mng_logic/reportKV?type=RegCaptcha&itemName=captcha_close")}).show(),(new Image).src="/qy_mng_logic/reportKV?type=RegCaptcha&itemName=login_get_verify_code_click")});var F=$("#get_second_check_vcode"),S=$("#second_check_vcode");function M(){$(".login_scan_panel").hide(),$("#only_scan_allow").show()}"-96"!=$("#second_check_errcode").val()&&"-96"!=te("errcode")||oe(S,"Incorrect verification code"),S.on("focus",function(){re(S)}),F.click(function(){if(!F.hasClass("disabled")){var e=$("#second_checkcode").val()||te("second_checkcode");ie(60,F),$.ajax({url:"/cgi-bin/bizmail_portal?action=send_sms&type=12&t=biz_rf_portal_mgr&ef=jsnew&resp_charset=UTF8",data:{second_checkcode:e},dataType:"JSON",success:function(e){"0"==e.retcode||("-2"==e.retcode?oe(S,"The mobile phone has not been bound and the verification code cannot be sent."):"-101"==e.retcode?oe(S,"The operation speed is too fast. Please try again in 1 minute."):-201==e.retcode?(y.show(),O(),ie(0,F),oe(k,"Enter the CAPTCHA code")):-202==e.retcode?(oe(k,"Image verification code error"),ie(0,F),O()):-1e4==e.retcode?(oe(S,"The number of times the verification code of this mobile number has been obtained has reached the daily limit."),ie(0,F),S.addClass("disabled")):(oe(S,"Failed to send CAPTCHA"),ie(0,F)))}})}}),$(document).on("click","[data-phone-uin]",function(e){"weixin"==$(e.currentTarget).attr("data-logintype")?se($(this).attr("data-phone-uin")):ce($(this).attr("data-phone-uin"),$(this).attr("data-no-force-scan"))});var B=$("#phone_bind_account_list"),R=!1;_.click(function(){var e=$.trim(d.val()),l=$.trim(c.val()),i=$.trim(s.val());if(!R)if(Q()){if(""!==$.trim(i)){R=!0;var a="/cgi-bin/bizmail_portal?action=auth_sms&type=11&resp_charset=UTF8";return"exmail.weixin.qq.com"==location.host&&(a="https://exmail.qq.com"+a),$.ajax({url:a,method:"POST",data:{area:l,mobile:e,phone_vc:i,f:"json"},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){var i=de(e.errorcode);if("0"==i)if(e.phone_login&&e.phone_login[0]&&e.phone_login[0].phone_alias){var a=e.phone_login[0].phone_alias;if(0<a.length&&e.area&&e.area[0]&&e.area[0].DATA&&(window.login_area=e.area[0].DATA),0===a.length)oe(d,"The phone does not have a bound account for the time being."),ie(0),X("WwBizmailLogin","mobile_noresult");else if(1===a.length){var n=de(a[0].alias),t=(de(a[0].newbizmail_wxplugin),de(a[0].no_force_scan_user));n&&ce(n,t)}else if(1<a.length)if("86"==l||""==l){var o=function c(e){for(var i=!0,a=!0,n=0;n<e.length;n++)de(e[n].newbizmail_wxplugin),de(e[n].no_force_scan_user),i=!1;return{isAllNew:i,isAllOld:a}}(a);if(o.isAllOld){var r=le(a);B.html(r),_e("accountlist")}else if(o.isAllNew)M();else{r=function s(e){for(var i=[],a=[],n=0;n<e.length;n++){var t=e[n];de(t.newbizmail_wxplugin),de(t.no_force_scan_user);i.push(t)}for(var o=le(i),r=['<div class="mixed_account_wrap">','<hr class="mixed_account_splitline">','<div class="mixed_account_title">','<span style="margin-right: 2px;">The following accounts only support</span><a href="/login">to log in.</a>\uff1a'].join(""),n=0;n<a.length;n++)r+='<div class="mixed_account_alias">'+de(a[n].alias)+"</div>";return o+(r+="</div></div>")}(a);B.html(r),_e("accountlist")}}else{r=le(a);B.html(r),_e("accountlist")}0<a.length&&(X("ActiveCodeLogin","mobile_vcode_login_hasaccount"),1<a.length&&X("ActiveCodeLogin","mobile_vcode_login_multi_account")),X("ActiveCodeLogin","mobile_vcode_login_succ")}else oe(d,"The phone does not have a bound account for the time being."),ie(0),X("WwBizmailLogin","mobile_noresult");else oe(m,"-98"==i?"Incorrect parameter":"-99"==i?"Incorrect verification code":"-101"==i||"-201"==i||"-202"==i?"The operation speed is too fast. Please try again in 1 minute.":"-300"==i?"System failure":"Failed to send CAPTCHA")},complete:function(){R=!1}}),X("ActiveCodeLogin","get_verify_code_login"),!1}oe(s)}else oe(d)});var V=["domain/manage"];L.on("click","[data-uin]",function(e){var t=$(e.currentTarget),o=t.attr("data-uin"),r=t.attr("data-type"),c=t.attr("data-owner-type"),s=t.attr("data-admin-type"),l=$('[name="login_from"]').val(),d=$('input[name="redirect_hash"]').val();if(C.find("[name=uin]").val(o),"feedback"==l&&"admin"==r)return me("Please use the member email account for feedback"),!1;if("admin"===r?(C.find("[name=fun]").val("bizmail_admin"),C.find("[name=domain]").val("biz.mail.qq.com")):(C.find("[name=fun]").val(""),-1<o.indexOf("@")&&C.find("[name=domain]").val(o.split("@")[1])),"1"==t.attr("data-verify")){var i=t.attr("data-mobile"),a=t.attr("data-area"),n=$("#verify_phone_item");return $(".js_verify_phone_txt").html("+"+a+" "+i),C.append('<input type="hidden" id="mobile" name="mobile" value="'+i+'">'),C.append('<input type="hidden" id="area" name="area" value="'+a+'">'),$("#verify_phone_btn").attr("data-type",r),L.hide(),n.show(),ie(60,I),$.ajax({url:"/cgi-bin/bizmail_portal?action=send_sms&type=11&t=biz_rf_portal_mgr&ef=jsnew&resp_charset=UTF8",data:{area:a,mobile:i},dataType:"JSON",success:function(e){console.log("sms json = ",e),"0"==e.retcode||("-2"==e.retcode?oe(m,"The mobile phone has not been bound and the verification code cannot be sent."):"-101"==e.retcode?oe(m,"The operation speed is too fast. Please try again in 1 minute."):oe(m,"Failed to send CAPTCHA"))},complete:function(){}}),!1}var _="/cgi-bin/login";"exmail.weixin.qq.com"==location.host&&(_="https://exmail.qq.com"+_),$.ajax(_,{type:"post",dataType:"json",data:C.serialize(),success:function(e){if(e.data&&15==e.data.bizmailjump)return!(location.href="/cgi-bin/loginpage?account_type=t_network_forbid");if(e.data&&16==e.data.bizmailjump)return!(location.href="/cgi-bin/loginpage?account_type=t_user_forbid");if(""===e.data.errcode&&""!=e.data.sid){var i="biz_rf_home";if("true"==e.data.isWwBizmail&&(i="qy_rf_home"),"super"==s?X("ProfileRole","superadmin_login"):"sub"==s?X("ProfileRole","subadmin_login"):"1"==c&&X("ProfileRole","corp_owner_login"),1!=e.data.transfer_user_need_verify||1==e.data.gid_no_wechat)if("feedback"==l)location.href="/cgi-bin/loginpage?sid="+e.data.sid+"&t=new_index/feedback";else if("BIZMAIL_ONLINESELL_FREE_TIP"===e.data.target)location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=1#onlineorder/confirm/"+e.data.order_num;else if("BIZMAIL_ONLINESELL_ONLINEVIP_TIP"===e.data.target)location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=3";else if("BIZMAIL_ONLINESELL_OFFLINEVIP_TIP"===e.data.target)location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=2";else if("BIZMAIL_ONLINESELL_OFFLINETRIAL_TIP"===e.data.target)location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=4#onlineorder/confirm/"+e.data.order_num;else if("BIZMAIL_ONLINESELL_ONLINETRIAL_TIP"===e.data.target)location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=5#onlineorder/confirm/"+e.data.order_num;else{if("admin"===r)d&&function a(e){return-1<V.indexOf(e)}(d)?location.href="/qy_mng_logic/frame?sid="+e.data.sid+"#/"+d:location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&r="+Math.random(),X("WwBizmailLogin","scan_login_"+(t.attr("data-admin")||"owner"));else"cn"==e.data.lang&&!function n(){var e=location.host,i=new Date((new Date).valueOf()+6048e5),a="locate="+escape("zh_CN")+"; path=/; domain="+e+"; expires="+i;document.cookie=a}(),"en"==e.data.lang&&"exmail.qq.com"==location.host?location.href="//en.exmail.qq.com/cgi-bin/frame_html?sid="+e.data.sid+"&r="+Math.random():"cn"==e.data.lang&&"en.exmail.qq.com"==location.host?location.href="//exmail.qq.com/cgi-bin/frame_html?sid="+e.data.sid+"&r="+Math.random():location.href="/cgi-bin/frame_html?sid="+e.data.sid+"&r="+Math.random()}else e.data.transfer_verify_area=e.data.transfer_verify_area||86,$(".js_merge_area").val(e.data.transfer_verify_area),$(".js_merge_mobile").val(e.data.transfer_verify_mobile),pe({sid:e.data.sid,area:e.data.transfer_verify_area,mobile:e.data.transfer_verify_mobile}),Y("biz_transfer","transfer|user|verify|page|view")}else""===e.data.errcode&&""!=e.data.redirecturl?location.replace(e.data.redirecturl):"-60"==e.data.errcode?me("Your corporate email account is disabled, please contact the corporate mailbox administrator."):"-61"==e.data.errcode&&e.data.sid?1==e.data.pwd_expired&&1==e.data.bind_wx?location.href="/qy_mng_logic/activateMail?sid="+e.data.sid+"/#/clearResetExpiredPwd/"+e.data.sid+"/no_auth_code/"+o:location.href="/cgi-bin/readtemplate?&nocheckframe=true&t=bizmail_usercpwd&sid="+e.data.sid+"&alias="+o:"-62"==e.data.errcode?me("The account is suspected of violating the rules and cannot be logged in."):"-63"==e.data.errcode?me("The administrator restricts the IP from logging into the corporate mailbox."):"-97"==e.data.errcode?me("This company has been disabled."):me("Login failed. Please try again later. Error code:"+e.data.errcode)},error:function(e){me("System error, please try again later")}})}),1==L.find("[data-uin]").size()&&L.find("[data-uin]").trigger("click"),I.click(function(){if(!I.hasClass("disabled")){var e=$("#mobile"),i=$.trim(e.val()),a=$.trim($("#area").val());ee(a,i)?(ie(60,I),$.ajax({url:"/cgi-bin/bizmail_portal?action=send_sms&type=11&t=biz_rf_portal_mgr&ef=jsnew&resp_charset=UTF8",data:{area:a,mobile:i},dataType:"JSON",success:function(e){console.log("sms json = ",e),"0"==e.retcode||("-2"==e.retcode?oe(m,"The mobile phone has not been bound and the verification code cannot be sent."):"-101"==e.retcode?oe(m,"The operation speed is too fast. Please try again in 1 minute."):oe(m,"Failed to send CAPTCHA"))},complete:function(){}})):oe(e)}}),$("#verify_phone_btn").on("click",function(e){if(!W.hasClass("login_btn_disabled")){if(""===$.trim(s.val()))return oe(s),!1;var a=$(this).attr("data-type"),i="/cgi-bin/login";"exmail.weixin.qq.com"==location.host&&(i="https://exmail.qq.com"+i),$.ajax(i,{type:"post",dataType:"json",data:C.serialize(),success:function(e){if(W.addClass("login_btn_disabled"),W.text("Verification is under way."),""===e.data.errcode&&""!=e.data.sid){var i="biz_rf_home";"true"==e.data.isWwBizmail&&(i="qy_rf_home"),"BIZMAIL_ONLINESELL_FREE_TIP"===e.data.target?location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=1#onlineorder/confirm/"+e.data.order_num:"BIZMAIL_ONLINESELL_ONLINEVIP_TIP"===e.data.target?location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=3":"BIZMAIL_ONLINESELL_OFFLINEVIP_TIP"===e.data.target?location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=2":"BIZMAIL_ONLINESELL_OFFLINETRIAL_TIP"===e.data.target?location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=4#onlineorder/confirm/"+e.data.order_num:"BIZMAIL_ONLINESELL_ONLINETRIAL_TIP"===e.data.target?location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=5#onlineorder/confirm/"+e.data.order_num:location.href="admin"===a?"/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&r="+Math.random():"/cgi-bin/frame_html?sid="+e.data.sid+"&r="+Math.random()}else"-99"==e.data.errcode?oe($("#sms_token"),"Incorrect verification code"):oe($("#sms_token"),"Verification failed")},error:function(e){W.removeClass("login_btn_disabled"),W.text("Next")}})}}),$("#btn_phone_login").click(function(e){var i="/cgi-bin/login";"exmail.weixin.qq.com"==location.host&&(i="https://exmail.qq.com"+i),$.ajax(i,{type:"post",dataType:"json",data:$("#login_choose_acc").serialize(),success:function(e){if("-24"==e.data.errcode||"-25"==e.data.errcode)$("#acc_vc_img").attr("src",$("#acc_vc_img").attr("src")+"0");else if(""===e.data.errcode&&""!=e.data.sid){var i="biz_rf_home";"true"==json.data.isWwBizmail&&(i="qy_rf_home"),"BIZMAIL_ONLINESELL_FREE_TIP"===e.data.target?location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=1#onlineorder/confirm/"+e.data.order_num:"BIZMAIL_ONLINESELL_ONLINEVIP_TIP"===e.data.target?location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=3":"BIZMAIL_ONLINESELL_OFFLINEVIP_TIP"===e.data.target?location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=2":"BIZMAIL_ONLINESELL_OFFLINETRIAL_TIP"===e.data.target?location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=4#onlineorder/confirm/"+e.data.order_num:"BIZMAIL_ONLINESELL_ONLINETRIAL_TIP"===e.data.target?location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&onlinesell_index_tip=5#onlineorder/confirm/"+e.data.order_num:$("[name='alias']").val().indexOf("@")<0?location.href="/cgi-bin/bizmail?sid="+e.data.sid+"&t="+i+"&init=1&r="+Math.random():location.href="/cgi-bin/frame_html?sid="+e.data.sid+"&r="+Math.random()}else e.data.errcode},error:function(e){}})}),$("#btlogin").click(function(e){return""===$.trim(u.val())?(oe(u,"Please fill in the full account number of the enterprise mailbox, or the administrator account number."),!1):""===$.trim(h.val())?(oe(h,"Enter the password."),!1):v.is(":visible")&&""===$.trim(p.val())?(oe(p,"Enter the verification code"),!1):("exmail.weixin.qq.com"==location.host&&$("#loginForm").attr("action","https://exmail.qq.com/cgi-bin/login"),$("#loginForm").append('<input type="hidden" name="data-statistic-login-type" value="home_login"/>'),X("ActiveCodeLogin","pwd_login"),!0)});var D=$("#complete_phone_container"),W=$("#complete_phone_btn"),Z=($("#phone_bind_account_list_wrap"),$("#active_alias"));function U(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}if(0<D.size()){ne();var H=$("#empty_wechat_phone_bind_account_list_wrap"),J=$("#empty_wechat_phone_bind_account_list");function G(e){"weixin"==e.attr("data-logintype")?se(e.attr("data-verify-uin")):ce(e.attr("data-verify-uin"))}function K(e,i){for(var a,n,t,o=[],r=1<e.length,c=0;c<e.length;c++){var s=e[c];o.push((n=i,t=r,['<div class="verify_list_item" data-verify-uin="'+de((a=s).alias)+'" data-type="verify" data-logintype="'+n+'">',t?['<div class="verify_list_item_icon">','<input name="verify_account" value="'+de(a.alias)+'" type="radio" class="verify_list_item_radio">',"</div>"].join(""):"",'<div class="verify_list_item_content">','<div class="verify_list_item_alias">'+de(a.alias)+"</div>",'<div class="verify_list_item_text">'+de(a.name)+'<span class="gray_dot"></span>'+de(a.corpname)+"</div>","</div>","</div>"].join("")))}return o.join("")}J.on("click","[data-verify-uin]",function(e){var i=$(e.currentTarget);1<J.find("[data-verify-uin]").size()?i.find("input[name=verify_account]")[0].checked=!0:G(i)}),$("#enter_phone_email").on("click",function(e){var i=J.find("[data-verify-uin]");1<i.size()?J.find("input[name=verify_account]").each(function(e,i){console.log("el = ",i,", el.checked = ",i.checked),i.checked&&G($(i).parents(".verify_list_item"))}):1==i.size()&&G(i)}),Z.on("blur",function(e){var i=$.trim($("#active_alias").val());""===i||U(i)||oe(Z)}),Z.on("focus",function(e){re(Z)}),$(document.body).on("click","[data-type=back-to-complete-info]",function(e){$(".login_scan_panel").hide(),$("#complete_phone_container").show()}),$("#complete_phone_btn_first").on("click",function(e){var i=$.trim(d.val()),a=$.trim(c.val()),r=$.trim($("#active_alias").val());Q()?0<r.length&&!U(r)?oe(Z):(X("ActiveCodeLogin",r?"complete_phone_info_both":"complete_phone_only_mobile"),$.ajax({url:"/cgi-bin/bizmail_portal",type:"POST",dataType:"json",data:{action:"check_procedure",active_alias:r,mobile:i,area:a,wx_login_code:te("code"),f:"json"},success:function(e){var i=de(e.login_procedure),a=de(e.mobile),n=de(e.area),t=$("#verify_phone_container");if(0==i)$("#complete_phone_container").hide(),$("#no_mail_found_wrap").show(),X("ActiveCodeLogin","no_mail_found");else if(1==i)$("#verify_phone_number").text("+"+n+" "+a.substr(0,3)+"****"+a.substr(7)),$("#complete_phone_container").hide(),t.show(),$("#btn_sms").click(),X("ActiveCodeLogin","mail_verify_phone");else if(2==i)$("#complete_phone_container").hide(),$("#verify_active_code_container").show(),X("ActiveCodeLogin","mail_verify_active_code");else if(3==i)$("#verify_phone_number").text("+"+n+" "+a.substr(0,3)+"****"+a.substr(7)),$("#complete_phone_container").hide(),t.find(".js_verify_phone").hide(),t.find(".js_verify_other_phone").show(),t.find("a#complete_phone_btn").attr("data-type","other_phone"),$("#btn_sms").attr("data-mobile",a),$("#btn_sms").attr("data-area",n),t.show(),setTimeout(function(){$("#btn_sms").click()});else if(4==i){var o=de(e.weixinname);o?($(".login_scan_panel").hide(),$("#another_wechat_account").text(o),$("#error_bind_another_wechat").show()):n&&a?($(".login_scan_panel").hide(),$("#another_mobile_number").text("+"+n+" "+a),$("#error_bind_another_mobile").show()):($(".login_scan_panel").hide(),$("#error_pwd_login").show(),$("#jump_login_pwd_with_alias").attr("href","/cgi-bin/loginpage?loginpanel=pwd&alias="+encodeURIComponent(r)))}}}),X("ActiveCodeLogin",r?"complete_both":"complete_only_phone")):oe(d)}),$("#verify_active_code").on("focus",function(e){re($("#verify_active_code"))}),$("#verify_active_code_btn").on("click",function(e){var i=$("#verify_active_code").val(),a=$.trim(d.val()),n=$.trim(c.val()),t=$.trim($("#active_alias").val());i?$.ajax({url:"/cgi-bin/bizmail_portal",type:"POST",dataType:"json",data:{action:"active_alias_info",active_alias:t,mobile:a,area:n,active_code:i,wx_login_code:te("code"),f:"json",resp_charset:"UTF8"},success:function(e){var i=de(e.errorcode);if(0==i){var a=de(e.active_name),n=de(e.active_alias),t=de(e.active_corp_name),o=$("#verify_personal_info");o.find(".verify_list_item_text").html(a+'<span class="gray_dot"></span>'+t),o.find(".verify_list_item_alias").text(n),o.find("#enter_email").attr("active_alias",n),o.show(),$("#verify_active_code_container").hide()}else-100==i?oe($("#verify_active_code")):me("Login error, error code:"+i)}}):oe($("#verify_active_code"))}),$("#enter_email").on("click",function(e){document.form1.fun&&(document.form1.fun.value=""),document.form1.vt&&(document.form1.vt.value="active_code_auth"),document.form1.uin&&(document.form1.uin.value=$("#enter_email").attr("active_alias")),document.form1.ppp&&(document.form1.ppp.value=""),document.form1.pp&&(document.form1.pp.value=""),"exmail.weixin.qq.com"==location.host&&$(document.form1).attr("action","https://exmail.qq.com/cgi-bin/login"),document.form1.submit()}),W.on("click",function(e){if(!W.hasClass("login_btn_disabled"))if("other_phone"!==W.attr("data-type")){var i=$.trim(d.val()),a=$.trim(c.val()),n=$.trim(s.val()),t=$.trim($("#active_alias").val());if(""!==$.trim(n))return W.addClass("login_btn_disabled"),W.text("Verification is under way."),$.ajax({url:"https://exmail.qq.com/cgi-bin/loginpage?action=wx_login_choose&f=json&resp_charset=UTF8&r="+Math.random(),type:"POST",dataType:"json",data:{mobile:i,area:a,phone_vc:n,wx_login_code:te("code"),active_alias:t},success:function(e){W.removeClass("login_btn_disabled"),W.text("Next");var i=de(e.wx_login_ret),a=e.wx_jump_phonelogin&&e.wx_jump_phonelogin[0]&&e.wx_jump_phonelogin[0].DATA;if("1"==a)if(e.phone_login&&e.phone_login[0]&&e.phone_login[0].phone_alias){var n=e.phone_login[0].phone_alias;if(0===n.length)oe(d,"The phone does not have a bound account for the time being."),ie(0);else if(1<=n.length){var t=K(n,1==a?"":"weixin");J.html(t),$("#verify_phone_container").hide(),H.show(),X("WwBizmailLogin","scan_addmobile_login"),$('[name="vt_fake"]').attr("name","vt")}}else oe(d,"The phone does not have a bound account for the time being."),ie(0);else if("0"==i)if(e.wx_login&&e.wx_login[0]&&e.wx_login[0].wx_alias){var o=e.wx_login[0].wx_alias;if(0===o.length)oe(d,"The phone does not have a bound account for the time being."),ie(0);else if(1<=o.length){t=K(o,1==a?"":"weixin");J.html(t),$("#verify_phone_container").hide(),H.show(),X("WwBizmailLogin","scan_addmobile_login")}}else oe(d,"The phone does not have a bound account for the time being."),ie(0);else"-98"==i?oe(m,"Incorrect parameter"):"-99"==i?oe(m,"Incorrect verification code"):"-101"==i||"-201"==i||"-202"==i?oe(m,"The operation speed is too fast. Please try again in 1 minute."):"-300"==i?oe(m,"System failure"):"-121"==i?($("#verify_phone_container").hide(),$("#no_mail_found_wrap").show(),X("WwBizmailLogin","scan_addmobile_noresult")):"-603"==i?(D.hide(),$("#mobile_bind_fail_wrap").show(),X("WwBizmailLogin","wx_binding_fail")):oe(m,"-1"==i?"Wechat's code scanning information has expired.":"Verification failed")},error:function(){W.removeClass("login_btn_disabled"),W.text("Next")}}),!1;oe(s)}else $.ajax({url:"/cgi-bin/login",type:"GET",dataType:"json",data:{uin:$("#active_alias").val(),vt:"confirm_phone_auth",wx_login_code:te("code"),phone_vc:$("[name=phone_vc]").val(),mobile:$("#btn_sms").attr("data-mobile"),area:$("#btn_sms").attr("data-area"),f:"json"},success:function(e){var i=de(e.errcode);if(i)me(-95==i?"Incorrect verification code":"Verification error");else{var a=de(e.sid);a&&(location.href="/cgi-bin/frame_html?sid="+a.split(",")[0]+",7&r="+Math.random())}}})}),X("WwBizmailLogin","scan_addmobile")}function X(e,i){(new Image).src="https://exmail.qq.com/qy_mng_logic/reportKV?type="+e+"&itemName="+i+"&r="+Math.random()}function Y(e,i){var a=$("#merge_sid").val()||$('[name="sid"]').val();(new Image).src=a?"/cgi-bin/sellonlinestatic?type=session_statistics&businame="+e+"&item="+i+"&sid="+a:"/cgi-bin/sellonlinestatic?type=nosession_statistics&businame="+e+"&item="+i}function Q(){var e=$.trim(d.val()),i=$.trim(c.val());return console.log("area = ",i,", mobile = ",e),86==i?11==e.length:e&&i}function ee(e,i){return 86==e?11==i.length&&/^[0-9]+$/.test(i):/^[0-9]+$/.test(i)}function ie(e,i){if(i=i||m,0<e){wait=!0;var a=e-1,n="Resend ("+a+"S)";i.addClass("disabled"),i.text(n),w=setTimeout(function(){ie(a,i)},1e3)}else wait=!1,i.removeClass("disabled"),i.text("get verify code"),clearTimeout(w)}window.logKV=X;var ae=!1;function ne(){ae||(q=new Dropdown({container:".js_countryCode_dropdown",dropDownClass:"qy_telInput_zipCode_input ",dropdownInputClass:"qy_inputText_Big",onChange:function(e){q.setText(e.value),i=+e.value,N()},onHide:function(){q.isValidCode(q.getText())?i!=q.getText()&&q.setText(i):q.setText(i)}}),$.extend(q,e),q.initialize(q.opt),q.selectByValue(i),q.scrollToSelectedItem(),ae=!0)}function te(e){var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(i);return null!=a?unescape(a[2]):null}function oe(e,i){var a=e.parents(".signup_item").eq(0),n=a.find(".signup_item_content_tips_normal"),t=a.find(".signup_item_content_tips_error");i&&t.text(i),a.addClass("signup_item_error"),0<n.size()&&(n.hide(),t.show())}function re(e){var i=e.parents(".signup_item").eq(0),a=i.find(".signup_item_content_tips_normal"),n=i.find(".signup_item_content_tips_error");i.removeClass("signup_item_error"),0<a.size()&&(a.show(),n.hide())}function ce(e,i){if(document.form1.fun&&(document.form1.fun.value=""),document.form1.vt&&(document.form1.vt.value="mobilecode"),document.form1.uin&&(document.form1.uin.value=e),document.form1.ppp&&(document.form1.ppp.value=""),document.form1.pp&&(document.form1.pp.value=""),document.form1.no_force_scan&&1==i&&document.form1.no_force_scan.value,"exmail.weixin.qq.com"==location.host&&$(document.form1).attr("action","https://exmail.qq.com/cgi-bin/login"),window.login_area){var a=$(document.form1).attr("action");-1<a.indexOf("?")?a+="&":a+="?",a=a+"login_area="+window.login_area,$(document.form1).attr("action",a)}document.form1.submit()}function se(e){document.form1.fun&&(document.form1.fun.value=""),document.form1.vt&&(document.form1.vt.value="weixin"),document.form1.uin&&(document.form1.uin.value=e),document.form1.ppp&&(document.form1.ppp.value=""),document.form1.pp&&(document.form1.pp.value=""),"exmail.weixin.qq.com"==location.host&&$(document.form1).attr("action","https://exmail.qq.com/cgi-bin/login"),document.form1.submit()}function le(e,i){for(var a,n,t,o,r=[],c=0;c<e.length;c++){var s=e[c];"0"==s.owner?r.push((o=i,['<div class="weixin_choose_list_item weixin_choose_list_item_member" data-no-force-scan="'+de((t=s).no_force_scan_user)+'" data-phone-uin="'+de(t.alias)+'" data-type="member" data-logintype="'+o+'">','<div class="weixin_choose_list_item_icon">','<div class="weixin_choose_member_icon"></div>',"</div>",'<div class="weixin_choose_list_item_content">','<div class="weixin_choose_list_item_title">Members</div>','<div class="weixin_choose_list_item_alias">'+de(t.alias)+"</div>",'<div class="weixin_choose_list_item_text">'+de(t.corpname)+"</div>","</div>","</div>"].join(""))):"1"==s.owner&&r.push((n=i,['<div class="weixin_choose_list_item weixin_choose_list_item_admin" data-phone-uin="'+de((a=s).alias)+'" data-type="admin" data-logintype="'+n+'">','<div class="weixin_choose_list_item_icon">','<div class="weixin_choose_admin_icon"></div>',"</div>",'<div class="weixin_choose_list_item_content">','<div class="weixin_choose_list_item_title">The admin</div>','<div class="weixin_choose_list_item_text">'+(de(a.corpname)||de(a.alias))+"</div>","</div>","</div>"].join("")))}return r.join("")}function de(e){return"string"==typeof e?e:e&&e[0]&&e[0].DATA!=undefined?e[0].DATA:e}function _e(e){if($("[data-panel]").hide(),$("[data-panel="+e+"]").show(),"phone"==e){var i=$("[data-panel="+e+"]").find(".img_vcode");i.attr("src",i.attr("src")+0)}}function me(e,i){!function a(){0==$("#tipsContainer").length&&$("body").append('<div id="tipsContainer" style="display:none;"><div id="tipsTop" class="tipsWrap topPos size14" style="display:none;"><span class="msg"></span></div><div id="tipsMsg" class="tipsWrap tipsCenter size14" style="display:none;"><span class="msg"></span></div><div id="tipsProcess" class="tipsWrap tipsCenter size14" style="display:none;"><span class="msg" style="background-color:gray;"></span></div><div id="tipsError" class="tipsWrap tipsCenter size14" style="display:none;"><span class="msg" style="background-color:orange;"></span></div></div>')}(),function t(e,i,a){var n=$("#tipsContainer");return n.show(),e.show().find("span").html(i),setTimeout(function(){n.hide(),e.hide()},a||2e3),this}($("#tipsError"),e,i)}function fe(n){n=n||{};var e="callback_"+ +new Date+parseInt(1e9*Math.random(),10),i="/qy_mng_logic/wxqrcode?sid="+n.sid+"&callback="+encodeURIComponent(e)+"&func=wx_auth&custom_style="+encodeURIComponent("https://exmail.qq.com/zh_CN/htmledition/style/qrcode/base.css");$(".js_verify_wx").attr("src",i),$("#accountList").hide(),$("#verify_merge_phone").hide(),$("#verify_merge_phone_full").hide(),$("#verify_merge_wx").show(),$(".js_verify_wx_title").append(n.weixinname),$("#merge_weixinname").val(n.weixinname),window.addEventListener("message",function(e){if(e.data){var i=e.data;$.ajax({url:"/cgi-bin/bizmail_portal?action=check_wechat_info&f=json&resp_charset=UTF8",data:{sid:n.sid,area:n.area,mobile:n.mobile,verifycode:i},dataType:"JSON",success:function(e){var i=$.fn.safeGetXmlData(e.errorcode),a=$.fn.safeGetXmlData(e.same_wechat);0==i?0==a?($(".js_verify_wx_content").hide(),$(".js_verify_wx_warn").show(),$(".js_verify_wx_warn_txt").text("Current Wechat and Wechat to be verified ["+n.weixinname+"] inconsistent")):($(".js_verify_wx_content").hide(),$(".js_verify_wx_succ").show(),setTimeout(function(){location.href="/cgi-bin/frame_html?sid="+n.sid},1500)):me("Verification failed. Please try again later")},complete:function(){}})}},!1),$(".js_merge_wx_deny").off("click").on("click",function(){ue(n)}),$(".js_confirm_wx_btn").off("click").on("click",function(){ue(n)}),$(".js_cancel_wx_btn").off("click").on("click",function(){location.href="/cgi-bin/loginpage?action=wx_login_choose&t=login_choose_account&tt=wx_login_choose&login_fun=verify&auth_wx_only=true&weixinname="+$("#merge_weixinname").val()+"&merge_sid="+n.sid+"&mobile="+n.mobile+"&area="+n.area})}function pe(c){if($("#accountList").hide(),c.mobile){$("#verify_merge_phone_full").remove(),$("#verify_merge_phone").show(),$.ajax({url:"/cgi-bin/bizmail_portal?action=transfer_send_sms&f=json&area="+c.area+"&mobile="+c.mobile}),ie(60,$(".js_verify_phone_sms_btn"));var e=c.mobile;c.area&&86!=c.area&&(e="+"+c.area),$(".js_verify_phone_txt").text(e)}else $("#verify_merge_phone_full").show(),$("#verify_merge_phone").remove(),ne();var i=$(".js_verify_phone_sms_btn"),n=$(".js_verify_vcode_input"),s=$("#mobile_merge_input"),l=$("#area_merge_input");i.off("click").on("click",function(){i.hasClass("disabled")||(c.mobile||ee(l.val(),s.val())?(ie(60,i),$.ajax({url:"/cgi-bin/bizmail_portal?action=transfer_send_sms&f=json",data:{sid:c.sid,area:$("#area_merge_input").val()||$("#merge_area").val(),mobile:$("#mobile_merge_input").val()||$("#merge_mobile").val()},dataType:"JSON",success:function(e){"0"==e.retcode?location.href="/cgi-bin/frame_html?sid="+c.sid:"-2"==e.retcode?oe(m,"The mobile phone has not been bound and the verification code cannot be sent."):"-101"==e.retcode?oe(m,"The operation speed is too fast. Please try again in 1 minute."):oe(m,"Failed to send CAPTCHA")}})):oe(s,"Enter a correct mobile number"))}),n.off("input propertychange").on("input propertychange",function(){n.val()?re(n):oe(n,"Enter the verification code")}),s.off("input propertychange").on("input propertychange",function(){ee(l.val(),s.val())?re(s):oe(s,"Enter a correct mobile number")}),$(".js_verify_phone_btn").off("click").on("click",function(e){var i=$(e.currentTarget);if(!i.hasClass("login_btn_disabled"))if(c.mobile||ee(l.val(),s.val())){if(!n.val())return oe(n,"Enter the verification code"),!1;var t=$("#area_merge_input").val()||$("#merge_area").val()||c.area,o=$("#mobile_merge_input").val()||$("#merge_mobile").val()||c.mobile,r=i.attr("data-report"),a="/cgi-bin/bizmail_portal?action=transfer_auth_sms&f=json&resp_charset=UTF8";"exmail.weixin.qq.com"==location.host&&(a="https://exmail.qq.com"+a),$.ajax(a,{dataType:"json",data:{sid:c.sid,area:t,mobile:o,phone_vc:n.val()},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(e){var i=$.fn.safeGetXmlData(e.errorcode),a=$.fn.safeGetXmlData(e.gid_no_wechat),n=$.fn.safeGetXmlData(e.weixinname)||"";0==i?(1!=a&&n?(c.area=t,c.mobile=o,c.weixinname=n,fe(c)):location.href="/cgi-bin/frame_html?sid="+c.sid,Y("biz_transfer",r+"|succ")):me(-99==i?"SMS verification code is incorrect. Please try again later.":"Verification error, please try again later")},error:function(e){me("System error, please try again later")}}),Y("biz_transfer",r+"|click")}else oe(s,"Enter a correct mobile number")}),$(".js_merge_phone_deny").off("click").on("click",function(){$.ajax({url:"/cgi-bin/bizmail_portal?action=later_fill_info&sid="+c.sid}),Y("biz_transfer","transfer|user|later|click"),location.href="/cgi-bin/frame_html?sid="+c.sid}),$(".js_reinput_mobile").off("click").on("click",function(){$.ajax({url:"/cgi-bin/bizmail_portal?action=later_fill_info&sid="+c.sid}),Y("biz_transfer","transfer|user|discard|click"),location.href="/cgi-bin/loginpage?t=login_choose_account&tt=wx_login_choose&login_fun=verify&merge_sid="+c.sid})}function ue(e){$.ajax({url:"/cgi-bin/bizmail_portal?action=no_my_wechat&f=json&sid="+e.sid+"&mobile="+e.mobile+"&area="+e.area}),location.href="/cgi-bin/frame_html?sid="+e.sid}if($("#auth_wx_only").val())fe({area:$("#merge_area").val()||86,mobile:$("#merge_mobile").val(),sid:$("#merge_sid").val(),weixinname:$("#merge_weixinname").val()});else if(1==$("#doverify").val()){pe({area:$("#merge_area").val()||86,mobile:$("#merge_mobile").val(),sid:$("#merge_sid").val()})}0<$("#wechat_scan_auto_login").length&&($.fn.delCookie("wechat_scan_auto_login"),$.fn.delCookie("force_wx_scan_login_tc"),$("#wechat_scan_auto_login").on("change",function(e){$("#wechat_scan_auto_login").is(":checked")?($.fn.setCookie("wechat_scan_auto_login","1",120),$.fn.setCookie("force_wx_scan_login_tc","1",120)):($.fn.delCookie("wechat_scan_auto_login"),$.fn.delCookie("force_wx_scan_login_tc"))}),$(".js_verify_item[data-type=phone]").click(function(e){$("#wechat_scan_auto_login").prop("checked",!1),$.fn.delCookie("wechat_scan_auto_login"),$.fn.delCookie("force_wx_scan_login_tc")}),$(".js_show_pwd_panel").click(function(e){$("#wechat_scan_auto_login").prop("checked",!1),$.fn.delCookie("wechat_scan_auto_login"),$.fn.delCookie("force_wx_scan_login_tc")}));var he=te("loginpanel");te("token");"pwd"==he?_e("pwd"):"phone"==he&&$(".js_show_phone_panel").trigger("click"),"https://exmail.qq.com/login"!==location.href&&"https://exmail.weixin.qq.com/login"!==location.href||X("ActiveCodeLogin","loginpage_pv"),window.showWeworkEmptyPanel=function(){$(".login_scan_panel").hide(),$("#wework_empty_panel").show()}});