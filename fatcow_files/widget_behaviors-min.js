
 
YAHOO.namespace('widget_behaviors','widget_container');(function(){var $E=YAHOO.util.Event,$D=YAHOO.util.Dom,$$=$D.getElementsByClassName,$C=YAHOO.util.Connect,$L=YAHOO.lang;if(YAHOO.env.getVersion('logger')){var _logger=YAHOO.widget.Logger._printToBrowserConsole;YAHOO.widget.Logger._printToBrowserConsole=function(oEntry){_logger(oEntry);if(window.console&&console.log&&!$L.isString(oEntry.msg)){console.log(oEntry.msg);}};YAHOO.widget.Logger.enableBrowserConsole();}
YAHOO.widget_behaviors.Widget=function(id,params){if(YAHOO.widget_container[id]){return;}else{YAHOO.widget_container[id]=this;}
this.container=$D.get(id);this.content=$$('widget-content','div',this.container)[0];this.params=params||{};this._attach_behaviors();if(this._has_content())this._intercept_forms();if(this.params.tier=='tierII'){$E.onDOMReady(function(){this._reload_content(false)},this,true);}};YAHOO.widget_behaviors.Widget.prototype={constructor:YAHOO.widget_behaviors.Widget,SCRIPT_TAGS:/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/img,WHITE_SPACE:/^\s*$/,WW_ACTION:/WidgetWrapper/,widget_wrapper:'/WidgetWrapper.cmp',image_base:window.location.protocol=='https:'?'https://'+window.location.hostname+'/images':'http://'+window.location.hostname+'/images/',toggle_content:function(){$D.getStyle(this.content,'display')=='none'?this.display_content():this.hide_content();},display_content:function(){if(!this._has_content()){this._reload_content(false);};$D.setStyle(this.content,'display','');if($L.isObject(this._expand_image)){this._expand_image.src=this.image_base+'/icons/controlpanel/icon_collapse.gif';this._expand_image.title='Collapse';}},hide_content:function(){$D.setStyle(this.content,'display','none');if($L.isObject(this._expand_image)){this._expand_image.src=this.image_base+'/icons/controlpanel/icon_expand.gif';this._expand_image.title='Expand';}},working:function(bWork){if(!$L.isObject(this._working_image)&&$L.isObject(this._behavior_list)){this._working_image=document.createElement('li');var img=document.createElement('img');img.src=this.image_base+'/icons/ajax_load.gif';this._working_image.appendChild(img);this._behavior_list.insertBefore(this._working_image,this._behavior_list.firstChild);$D.setStyle(this._working_image,'display','none');};$D.setStyle(this._working_image,'display',bWork?'':'none');},popup_panel:function(params){this._popup_panel=this.popup_panel||{};var panel_id=params.name||'default';if($L.isObject(this._popup_panel[panel_id])){this._popup_panel[panel_id].show();return false;};params=params||{};var config={width:params.width,height:params.height||null,close:true,draggable:true,visible:false,xy:[10,document.documentElement.scrollTop+10]};if(params.context){var context=$D.get(params.context);var panel=new YAHOO.widget.Panel(this.container.id+'_popup_panel_'+panel_id,config);panel.setHeader(params.title);panel.setBody(context);panel.render(document.body);panel.show();this._popup_panel[panel_id]=panel;return false;}else if(params.url){this.working(true);$C.asyncRequest('GET',params.url,{scope:this,timeout:60000,failure:function(o){this.working(false);},success:function(o){var panel=new YAHOO.widget.Panel(this.container.id+'_popup_panel_'+panel_id,config);panel.setHeader(params.title);panel.setBody(o.responseText);panel.render(document.body);this._eval_scripts(o.responseText);panel.show();this.working(false);this._popup_panel[panel_id]=panel;}});return false;}},popup_panel_exists:function(name){return $L.isObject(this._popup_panel[name||'default']);},refresh:function(params){this.params.params=this._merge_uri_params(this.params.params,params);this._reload_content(true);return false;},_reload_content:function(clear_cache){this.working(true);var load_widget=(this.params.tier=='tierII'||this.params.tier=='tierIII')?true:false;var params=[this.params.params];if(load_widget)params.push('load_widget=1');if(clear_cache)params.push('clear_widget_cache=1');if(YAHOO.widget_container[this.container.id])params.push('__got_widget_js=1');var successHandler=function(o){if(o.getResponseHeader&&o.getResponseHeader['X-Redirect']){window.location=o.getResponseHeader['X-Redirect'];return;}
var holder=document.createElement('div');holder.innerHTML=o.responseText;try{this.container.replaceChild($$('widget-content','div',holder)[0],this.content);$D.removeClass(this.container,'error');}catch(e){$D.addClass(this.container,'error');this.working(false);try{this.container.replaceChild(holder.firstChild,this.content);}catch(e){}};this.content=$$('widget-content','div',this.container)[0];this._eval_scripts(o.responseText);if(this._has_content())this._intercept_forms();this.display_content();this.working(false);};$C.asyncRequest('POST',this.widget_wrapper,{scope:this,timeout:60000,failure:function(o){YAHOO.log(o);this.working(false);},success:successHandler,upload:successHandler},params.join('&'));},_click_configure:function(){if($L.isString(this.params.config_path)){window.open(this.params.config_path);}},_click_info:function(){if($L.isString(this.params.doc_path)){window.open(this.params.doc_path);}},_click_reload:function(){this._reload_content(true);},_generic_form_submit:function(e){$E.stopEvent(e);var oForm=$E.getTarget(e),isUpload=false;if(!oForm.elements&&oForm.form){oForm=oForm.form;};var post_disable=[];for(var i=0,len=oForm.elements.length;i<len;i++){var elm=oForm.elements[i];switch(elm.type){case'file':if(!elm.disabled&&elm.name&&elm.value){isUpload=true;};break;case'submit':if($D.hasClass(oForm,'disable-submit')||$D.hasClass(elm,'disable-submit')){post_disable.push(elm);};break;default:break;}};$C.setForm(oForm,isUpload,window.location.protocol=='https:'?true:null);for(var i in post_disable){post_disable[i].disabled=true;};this._reload_content(true);$C.setForm(undefined);},_attach_behaviors:function(){this._behavior_list=$$('behaviors','ul',this.container)[0];if(this._behavior_list){var images=this._behavior_list.getElementsByTagName('img');for(var i=0,len=images.length;i<len;++i){var image=images[i];$D.setStyle(image,'cursor','pointer');if($D.hasClass(image,'refresh')){$E.on(image,'click',this._click_reload,this,true);}else if($D.hasClass(image,'gear')){$E.on(image,'click',this._click_configure,this,true);}else if($D.hasClass(image,'help')){$E.on(image,'click',this._click_info,this,true);if(image.title&&YAHOO.env.getVersion('container')){this.info_tooltip=new YAHOO.widget.Tooltip(this.container.id+'_tt',{context:image,width:'350px',autodismissdelay:10000});}}else if($D.hasClass(image,'expand')||$D.hasClass(image,'collapse')){this._expand_image=image;$E.on(this._expand_image,'click',this.toggle_content,this,true);this._header=this._behavior_list.parentNode;$E.on(this._header,'dblclick',function(e){var target=$E.getTarget(e);target.focus();if(!target.tagName.match(/H2/i))return;this.toggle_content();},this,true);}else{continue}};};},_intercept_forms:function(){var widget_forms=this.content.getElementsByTagName('form');for(var i=0,len=widget_forms.length;i<len;++i){if(this.WW_ACTION.test(widget_forms[i].action)){$E.removeListener(widget_forms[i],'submit');$E.on(widget_forms[i],'submit',this._generic_form_submit,this,true);}}},_has_content:function(){return this.content&&!this.WHITE_SPACE.test(this.content.innerHTML);},_merge_uri_params:function(){var args=[];for(var i=0,len=arguments.length;i<len;i++){if(arguments[i]&&$L.isString(arguments[i])){args.push(arguments[i]);}};var temp={},items=[];var params=args.join('&').split('&');for(var i=0,len=params.length;i<len;++i){items=params[i].split('=');temp[items[0]]=items[0]+'='+items[1];};params=[];for(var i in temp){params.push(temp[i]);};return decodeURI(encodeURI(params.join('&')));},_eval_scripts:function(sContent){while(this.SCRIPT_TAGS.exec(sContent)){var script=RegExp.$1;try{if(window.execScript){window.execScript(script,'JavaScript');}else{window.eval?window.eval(script):eval(script);}}catch(e){YAHOO.log(e);YAHOO.log(script);}}}};YAHOO.widget_behaviors.command=function(widgetID,f){try{return YAHOO.widget_container[widgetID][f].apply(YAHOO.widget_container[widgetID],[].slice.call(arguments,2));}catch(e){return true;}};})();var $WW=YAHOO.widget_behaviors.command;
